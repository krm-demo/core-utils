package org.krmdemo.techlabs.opentest4j;

import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Tag;
import org.junit.jupiter.api.Test;
import org.krmdemo.techlabs.thtool.ThymeleafToolCtx;

import static org.assertj.core.api.Assertions.assertThat;
import static org.krmdemo.techlabs.thtool.ThymeleafToolCtx.DEFAULT_VARS_DIR__AS_FILE;

/**
 * A unit-test for <b>{@code th-tool}</b>-helper {@link OpenTest4jHelper}.
 */
@Tag("integration-test")
public class OpenTest4jHelperTest {

    private static final ThymeleafToolCtx ttCtx = new ThymeleafToolCtx();

    @BeforeAll
    static void beforeAll() {
        ttCtx.processDirectory(DEFAULT_VARS_DIR__AS_FILE);
    }

    @Test
    void testBadgeHtml() {
        OpenTest4jHelper openTest4j = OpenTest4jHelper.fromCtxLazy(ttCtx);
        assertThat(openTest4j.getBadgeHtml()).contains("open-test-report.html");
        assertThat(openTest4j.getBp().getRoot().getBadgeHtml()).contains("open-test-report.html");
    }

    @Test
    void testBadgeMarkdown() {
        OpenTest4jHelper openTest4j = OpenTest4jHelper.fromCtxLazy(ttCtx);
        assertThat(openTest4j.getBadgeMarkdown()).contains("open-test-report.html");
        assertThat(openTest4j.getBp().getRoot().getBadgeMD()).contains("open-test-report.html");
    }

    @Test
    void testALinkToMavenExecInPom() {
        OpenTest4jHelper openTest4j = OpenTest4jHelper.fromCtxLazy(ttCtx);
        assertThat(openTest4j.getALinkToMavenExecInPom()).contains("pom.xml");
    }

    @Test
    void testALinkToJUnitProps() {
        OpenTest4jHelper openTest4j = OpenTest4jHelper.fromCtxLazy(ttCtx);
        assertThat(openTest4j.getALinkToJUnitProps()).contains("junit-platform.properties");
    }
}

package org.krmdemo.techlabs.opentest4j;

import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import lombok.extern.slf4j.Slf4j;
import org.opentest4j.reporting.tooling.core.htmlreport.DefaultHtmlReportWriter;
import org.opentest4j.reporting.tooling.core.htmlreport.HtmlReportWriter;

import java.nio.file.Path;
import java.util.List;
import java.util.Map;

import static org.krmdemo.techlabs.core.dump.DumpUtils.dumpAsYamlTxt;

/**
 * Attempt to read the XML-reports, which is provided by "Open Test Alliance for the JVM"
 *
 * @see <a href="https://github.com/ota4j-team/open-test-reporting">
 *     open-test-reporting
 * </a>
 */
@Slf4j
public class ReportXmlParserTest {

    public static void main(String[] args) throws Exception {
        logInfo("==== started '%s.main()': ====", ReportXmlParserTest.class);
        HtmlReportWriter otrWriter = new DefaultHtmlReportWriter();

        Path otrInputXmlPath = Path.of("./target/open-test-report.xml");
        Path otrOutputHtmlPath = Path.of("./target/open-test-report-from-test.html");
        otrWriter.writeHtmlReport(List.of(otrInputXmlPath), otrOutputHtmlPath);

        XmlMapper xmlMapper = new XmlMapper();
        Map<String, Object> otrInputMap = xmlMapper.readValue(otrInputXmlPath.toFile(),new TypeReference<>(){});
        System.out.println("otrInputMap --> " + dumpAsYamlTxt(otrInputMap));
    }

    private static void logInfo(String formatString, Object... formatArgs) {
        if (log.isInfoEnabled()) {
            log.info(String.format(formatString, formatArgs));
        }
    }

}

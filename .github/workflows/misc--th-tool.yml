name: th-tool
run-name: ${{ github.actor }} has executed 'misc--th-tool.yml' â„–${{ github.run_number }}
on: workflow_dispatch

jobs:

  th-tool:
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout the latest version of repo in '${{ github.ref }}'"
        uses: actions/checkout@v4
      - name: Set up JDK 21 (Amazon Corretto)
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'corretto'
          check-latest: true
          cache: 'maven'
          cache-dependency-path: pom.xml

      - name: "Setup JBang"
        uses: jbangdev/setup-jbang@main
      - run: jbang properties@jbangdev 'java.v' 'java.r' 'java.s' 'sun.*' 'user.*'

      - name: Dump Environment-Variables into '.github/th-vars'-dir
        run: |
          # dump the output of './src/scripts/jbang/DumpEnvVars.java' into JSON-file
          jbang --quiet src/scripts/jbang/DumpEnvVars.java
          jbang --quiet src/scripts/jbang/DumpEnvVars.java > .github/th-vars/var-envVars.json

      - name: Dump Java System-Properties into '.github/th-vars'-dir
        run: |
          # dump the output of './src/scripts/jbang/DumpSysProps.java' into JSON-file
          jbang --quiet src/scripts/jbang/DumpSysProps.java
          jbang --quiet src/scripts/jbang/DumpSysProps.java > .github/th-vars/var-sysProps.json

      - name: Dump Git-Hub context into '.github/th-vars'-dir
        run: |
          # dump the value of {{ github }} into JSON-file
          echo '${{ toJson(github) }}' > .github/th-vars/var-github.json

      - name: Dump 'secrets' context into '.github/th-vars'-dir
        run: |
          # dump the value of {{ secrets }} into JSON-file
          echo '${{ toJson(secrets) }}' > .github/th-vars/var-secrets.json

      - run: .github/th-tool.sh --var-file mavenPropsFromFile=./target/classes/META-INF/maven/maven-project.properties
